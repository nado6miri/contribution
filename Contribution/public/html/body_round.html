<!DOCTYPE html>
<html>
<body>
    <div class="jumbotron container body-content">
        <div>
            <h2>Donation : Small Round</h2>
            <p>To make the tabs toggleable, add the data-toggle="tab" attribute to each link. Then add a .tab-pane class with a unique ID for every tab and wrap them inside a div element with class .tab-content.</p>
            <div class="myprogress">
                <div>Progress of Donation Round:</div>
                <div id="dynamic" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                    <span id="current-progress"></span>
                </div>
            </div>
            <hr />

            <div id="mainmenu">
                <p>
                    Select your Lucky Number : <input id="numd" type="number" min="0" max="10" value="5">
                    <input id="numc" type="number" min="0" max="9" value="3">
                    <input id="numb" type="number" min="0" max="9" value="2">
                    <input id="numa" type="number" min="1" max="9" value="1">
                    <button type="button" id="Contribution" class="btn btn-primary btn-sm">Contribution &raquo;</a></button>
                </p>
            </div>

            <hr />
            <div id="tab1">
                <ul id="tabmenu" class="nav nav-tabs nav-pills">
                    <li class="active"><a data-toggle="tab" href="#RoundRule">RoundRule</a></li>
                    <li><a data-toggle="tab" href="#donator">Contribution List</a></li>
                    <li><a data-toggle="tab" href="#beneficiary">Beneficiary List</a></li>
                    <li><a data-toggle="tab" href="#RoundRule">Policy</a></li>
                </ul>
            </div>

            <div class="tab-content">
                <div id="RoundRule" class="tab-pane fade in active">
                    <p>
                        • 게임 룰
                        EOS20과 EOS100의 당첨금이 다른 로또게임입니다.EOS20는 매 회차 당첨금이 20EOS이며, 해당되는 로또번호는 1-200입니다. EOS100는 매 회차 당첨금이 100EOS이며, 해당되는 로또번호는 1-1000입니다. 매번 베팅하실때 마다 해당되는 로또번호를 얻게되며, 모든 구좌가 모두 소진된 후 추첨에 들어가며 추첨시간은 3분정도 걸립니다. 마지막에 럭키넘버에 해당되는 사용자는 당첨금의 95%를 얻게 됩니다.

                        • 공평성
                        행운번호의 계산은 구매자들의 거래 해시와 해당하는 블록 해시를 시드로 삼아 공평한 계산법을 통해 나옵니다.

                        이 숫자들은 공개되어있고 무작위이여, 조작될 수 없습니다. 이로써 행운번호 계산의 공평성을 보장했습니다.

                        매 회차 상세정보를 통해 해당 회차의 당첨 번호의 상세한 계산 과정을 찾아보실 수 있으며, 사용자가 스스로 검증해 볼 수 있습니다.

                        계산법：
                        1.해당 회차의 모든 거래 해시값의 마지막 4자리를 십진법으로 전환하여 합계인 a를 구합니다.

                        2.해당 회차의 모든 거래 블록의 블록 해시값의 마지막 4자리를 십진법으로 전환하여 합계인 b를 구합니다.

                        3.a와 b를 합한 후 1000으로 나눈 숫자에 1을 더하여 행운번호를 얻습니다.

                        • 게임방법
                        STEP 1 ：구매
                        두 가지 방법을 통해 베팅하실 수 있습니다.

                        방법1：로그인 후 베팅

                        Scatter를 통해 로그인하시고 베팅할 수를 입력한 후 "베팅" 버튼을 눌러 지불하실 수 있습니다.

                        방법2：송금을 통한 베팅

                        EOS 20 로또베팅주소（0.1 EOS/구좌）：eosbiggame33

                        EOS 100 로또베팅주소 (0.1 EOS/구좌）：eosbiggame11

                        주의: 게임의 구좌에 해당하는 정수의 금액만 입금할 수 있습니다. 그렇지않은 경우 송금이 되지 않습니다. (예: EOS 100의 경우 1 넘버당 0.1 EOS 이므로 0.11, 0.111의 금액을 송금할 경우 송금이 되지 않습니다. 마찬가지로 EOS 500의 경우 1 넘버당 0.5 EOS 이므로 0.51 혹은 0.6의 금액을 송금할 경우 송금이 되지 않습니다) 또한, 매회 구매할 수 있는 수량을 초과하게 되면, 나머지 금액은 자동으로 다음 회차로 넘어갑니다.

                        STEP 2：추첨
                        매회 모든 번호가 판매된 후 공개된 계산법을 통해 행운번호를 얻습니다. 행운번호와 같은 번호의 사용자가 당첨되는 것입니다.

                        체인상의 모든 거래가 롤백 될 가능성이 있으므로 매회 모든 번호가 구매되고 2~3분정도를 기다린 후 시스템이 추첨을 진행합니다.

                        STEP 3：당첨
                        추첨결과를 공개한 후 시스템이 자동으로 상금을 당첨자에게 이체하고 거래 id를 공개합니다.

                        • 당첨금 분배
                        매회 당첨금의 95%는 당첨자의 상금이고, 나머지 5%는 추천보너스와 task 상금 및 운영에 쓰입니다.
                    </p>
                </div>
                <div id="donator" class="tab-pane fade">
                    <h3>Menu 1</h3>
                    <div id="sminfo_div">
                        <span id=msgs></span>
                        <table id="donate_list" border="1" class="fixed_header">
                            <thead>
                            <th width="120px">Round No</th>
                            <th width="60px">Order</th>
                            <th width="120px">Time</th>
                            <th width="120px">Donator</th>
                            <th width="120px">Amount</th>
                            <th width="120px">SYM</th>
                            <th width="120px">Lucky Code</th>
                            <th width="600px">TxID</th>
                            </thead>
                            <tbody id="insert_sminfo_table">
                                <!--
                        <tr><td>S00001</td><td>1</td><td>2018/10/15-09:00:34</td><td>iloveyoutube</td><td>1</td><td>EOS</td><td>55</td><td>7893...2344</td></tr>
                        <tr><td>S00001</td><td>2</td><td>2018/10/15-09:00:35</td><td>ilovelgtwins</td><td>100</td><td>GOLD</td><td>35</td><td>3293...2233</td></tr>
                        -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="beneficiary" class="tab-pane fade">
                    <h3>Menu 2</h3>
                    <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
                </div>
                <div id="RoundRule" class="tab-pane fade">
                </div>
            </div>
        </div>
        <hr />
        <hr />
        <div>
            <b>Send message</b>
            <p>Message  <input type="text" id="cmdbox" />
        </div>
</body>
</html>


<script type="text/javascript">
    /*
    var network = { blockchain: 'eos', protocol: 'http', host: 'api.eosnewyork.io', port: 80, chainId: 'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906' };
    //var network = { blockchain: 'eos', protocol: 'http', host: 'nodes.get-scatter.com', port: 443, chainId: 'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906' };

    // You can pass in any additional options you want into the eosjs reference.
    const eosOptions = { expireInSeconds:60 };
    const config = {
        expireInSeconds: 60,
        broadcast: true,
        debug: true,
        sign: true,
        httpEndpoint: 'https://api.eosnewyork.io',
        chainId: 'aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906',
    };
    */
    /*
    var network = { blockchain: 'eos', protocol: 'http', host: 'jungle.cryptolions.io', port: 18888, chainId: '038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca' };
    // You can pass in any additional options you want into the eosjs reference.
    const eosOptions = { expireInSeconds: 60 };
    const config = {
        expireInSeconds: 60,
        broadcast: true,
        debug: true,
        sign: true,
        httpEndpoint: 'http://jungle.cryptolions.io:18888',
        chainId: '038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca',
    };

    const keyProvider = ['PrivateKey1', 'PrivateKey2'];
    // We're also going to require an account that is connected to the network we're using.
    const requiredFields = { accounts: [network] };

    var account = {}; 
    var persist_account = {};
    var socket = 0;
    var login_status = false;
    */
    $(document).ready(function () {
        //$('#alertmsg').hide();
        $(".close").click(function () {
            $("#alertmsg").alert("close");
        });
        $("#scatterLogin").click(function () { Scatter_Login(); });
        $("#scatterLogout").click(function () { Scatter_Logout(); });
        $("#Contribution").click(function () { Contribution(); });
        $(function () {
            var current_progress = 0;
            var interval = setInterval(function () {
                current_progress += 10;
                $("#dynamic")
                    .css("width", current_progress + "%")
                    .attr("aria-valuenow", current_progress)
                    .text(current_progress + "% Complete");
                if (current_progress >= 100)
                    clearInterval(interval);
            }, 1000);
        });
    });

    /*
    function Scatter_Login() {
        //alert("Scatter_Login");
        if (login_status)
        {
            alert("Already Scatter LogIn Status.");
            $(".close").click(function () {
                $("#myAlert").alert("close");
            });
        }
        else
        {
            scatter.connect("Contribution-donate Program")
                .then(function (connected) {
                    console.log('connected', connected);
                    if (connected != true) {
                        alert("Can't find scatter - Not connected");
                        return;
                    }
                })
                .catch(function (x) {
                    console.log('x', x);
                });

            if (scatter.identity) {
                console.log("Already get identity");
                console.log("Account Info = " + persist_account.name + '@' + persist_account.authority);
                console.log("Blockchain Accounts = " + persist_account.blockchain);
            }

            // Now we need to get an identity from the user.
            scatter.getIdentity(requiredFields)
                .then(() => {
                    // Always use the accounts you got back from Scatter. Never hardcode them even if you are prompting
                    // the user for their account name beforehand. They could still give you a different account.
                    account = scatter.identity.accounts.find(x => x.blockchain === 'eos');

                    console.log("Account Info = " + account.name + '@' + account.authority);
                    console.log("Blockchain Accounts = " + account.blockchain);
                    persist_account.name = account.name;
                    persist_account.authority = account.authority;
                    persist_account.blockchain = account.blockchain;
                    let strtmp = "<strong> [" + account.name + '@' + account.authority + "]</strong>";
                    $('#accname').html(strtmp);
                    $('#scatterLogin').removeClass('btn-primary').addClass('btn-success');
                    login_status = true;
                })
                .catch(error => {
                    // The user rejected this request, or doesn't have the appropriate requirements.
                    console.error(error.message);
                    alert(error.message);
                });
        }
    }

    function Scatter_Logout() {
        //alert("Scatter_Logout");
        if (login_status) {
            scatter.forgetIdentity()
                .then((result) => {
                    account.name = account.authority = account.blockchain = null;
                    console.log("Account Info = " + account.name + '@' + account.authority);
                    console.log("Blockchain Accounts = " + account.blockchain);
                    persist_account.name = account.name;
                    persist_account.authority = account.authority;
                    persist_account.blockchain = account.blockchain;
                    login_status = false;
                    alert("Logout Success!!");
                    let strtmp = "<strong>" + "[ ************@****** ]" + "</strong>";
                    $('#accname').html(strtmp);
                    $('#scatterLogin').removeClass('btn-success').addClass('btn-primary');
                })
                .catch(error => {
                    console.error(error.message);
                    alert(error.message);
                });
        }
        else
        {
            alert("Already Logout Status");
        }
    }


    function Contribution() {
        if(login_status == false)
        {
            Scatter_Login();
        }
        else
        {
            //Get a proxy reference to eosjs which you can use to sign transactions with a user's Scatter.
            const eos = scatter.eos(network, Eos, config);

            // ----------------------------
            // Now that we have an identity, an EOSIO account, and a reference to an eosjs object we can send a transaction.
            // ----------------------------

            // Never assume the account's permission/authority. Always take it from the returned account.
            //const transactionOptions = { authorization:[`${account.name}@${account.authority}`] };
            const transactionOptions = {
                authorization: [`${account.name}@${account.authority}`],
                broadcast: true,
                sign: true
            };

            eos.transfer(account.name, 'goldenbucket', '1.0000 EOS', 'Contribution-99-100', transactionOptions)
                .then(trx => {
                    console.log(`Transaction ID: ${trx.transaction_id}`);
                })
                .catch(error => {
                    let errorjson = JSON.parse(error);
                    console.error("error =", error);
                    alert("error code =" + errorjson['code'] + "\n" + "Message=" + errorjson['error']['details'][0]['message']);
                });
        }
    }

    function onlyNumber(event) {
        event = event || window.event;
        var keyID = (event.which) ? event.which : event.keyCode;
        if ((keyID >= 48 && keyID <= 57) || (keyID >= 96 && keyID <= 105) || keyID == 8 || keyID == 46 || keyID == 37 || keyID == 39)
            return;
        else
            return false;
    }
    function removeChar(event) {
        event = event || window.event;
        var keyID = (event.which) ? event.which : event.keyCode;
        if (keyID == 8 || keyID == 46 || keyID == 37 || keyID == 39)
            return;
        else
            event.target.value = event.target.value.replace(/[^0-9]/g, "");
    }


    function socket_communication() {
        if (socket == 0) {
            socket = io.connect('http://localhost:5555');
            var SYM = ['EOS', 'GOLD'];

            socket.on('insert_last', function (data) {
                console.log("Insert Table");
                $('#msgs').text(data.msg + '==Insert Table');
                //$('#donate_list > tbody:last').append('<tr><td>Last</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');
                var my_tbody = document.getElementById('insert_sminfo_table');
                var row = my_tbody.insertRow(my_tbody.rows.length); // 하단에 추가
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
                var cell7 = row.insertCell(6);
                var cell8 = row.insertCell(7);
                cell1.innerHTML = data.id;
                cell2.innerHTML = data.roundid;
                cell3.innerHTML = data.jointime;
                cell4.innerHTML = data.donator;
                cell5.innerHTML = data.donamteamt;
                cell6.innerHTML = SYM[data.donatetype];
                cell7.innerHTML = data.luckycode;
                cell8.innerHTML = "txid";
            });

            socket.on('insert_first', function (data) {
                console.log("Insert Table");
                $('#msgs').text(data.msg + '==Insert Table');
                //$('#donate_list > tbody').append('<tr><td>First</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');
                var my_tbody = document.getElementById('insert_sminfo_table');
                var row = my_tbody.insertRow(0); // 상단에 추가
                //var row = my_tbody.insertRow(my_tbody.rows.length); // 하단에 추가
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
                var cell7 = row.insertCell(6);
                var cell8 = row.insertCell(7);
                cell1.innerHTML = data.id;
                cell2.innerHTML = data.roundid;
                cell3.innerHTML = data.jointime;
                cell4.innerHTML = data.donator;
                cell5.innerHTML = data.donamteamt;
                cell6.innerHTML = SYM[data.donatetype];
                cell7.innerHTML = data.luckycode;
                cell8.innerHTML = "txid";
            });

            socket.on('update', function (data) {
                console.log("update / Insert Table");
                $('#msgs').text(data.msg + '==Insert Table');
                var my_tbody = document.getElementById('insert_sminfo_table');
                var row = my_tbody.insertRow(my_tbody.rows.length); // 하단에 추가
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                var cell6 = row.insertCell(5);
                var cell7 = row.insertCell(6);
                var cell8 = row.insertCell(7);
                cell1.innerHTML = data.id;
                cell2.innerHTML = data.roundid;
                cell3.innerHTML = data.jointime;
                cell4.innerHTML = data.donator;
                cell5.innerHTML = data.donamteamt;
                cell6.innerHTML = SYM[data.donatetype];
                cell7.innerHTML = data.luckycode;
                cell8.innerHTML = "txid";
            });

            //===========================================================
            $("#cmdbox").keyup(function (event) {
                if (event.which == 13) {
                    socket.emit('clientcmd', { msg: $('#cmdbox').val() });
                    $('#cmdbox').val('');
                }
            });
        }
    }
    */
</script>

<!--
   scrollable table....
   https://medium.com/@vembarrajan/html-css-tricks-scroll-able-table-body-tbody-d23182ae0fbc
-->
